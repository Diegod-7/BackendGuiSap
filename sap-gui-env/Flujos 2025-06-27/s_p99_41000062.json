{
  "steps": {

    /* -------  abrir la transacción  ------- */
    "startTransaction": {
      "action":   "callProgram",
      "method":   "sapSession.StartTransaction",
      "paramKey": "Tcode",              /* ej. "S_P99_41000062" */
      "next":     "waitVariant"
    },

    /* -------  esperar formulario principal  ------- */
    "waitVariant": {
      "action":  "waitFor",
      "target":  "variant.window",
      "timeout": "30s",
      "next":    "setPlant"
    },

    /* -------  filtros de valor único  ------- */
    "setPlant": {
      "action":   "set",
      "target":   "{{usr}}ctxtP_WERKS",
      "paramKey": "Plant",
      "next":     "setP_VARIAN"
    },

    "setP_VARIAN": {
      "action":   "set",
      "target":   "{{usr}}ctxtP_VARIAN",
      "paramKey": "P_VARIAN",
      "next":     "setMaterialLow"
    },

    /* -------  rango Material  ------- */
    "setMaterialLow": {
      "action":   "set",
      "target":   "{{usr}}ctxtR_MATNR-LOW",
      "paramKey": "MaterialLow",
      "next":     "setMaterialHigh"
    },
    "setMaterialHigh": {
      "action":   "set",
      "target":   "{{usr}}ctxtR_MATNR-HIGH",
      "paramKey": "MaterialHigh",
      "next":     "setValTypeLow"
    },

    /* -------  rango Valuation Type  ------- */
    "setValTypeLow": {
      "action":   "set",
      "target":   "{{usr}}ctxtR_BWTAR-LOW",
      "paramKey": "ValuationTypeLow",
      "next":     "setValTypeHigh"
    },
    "setValTypeHigh": {
      "action":   "set",
      "target":   "{{usr}}ctxtR_BWTAR-HIGH",
      "paramKey": "ValuationTypeHigh",
      "next":     "clickExecute"
    },

    /* -------  ejecutar  ------- */
    "clickExecute": {
      "action": "click",
      "target": "variant.execBtn",
      "next":   "waitProcessing"
    },

    "waitProcessing": {
      "action":  "waitFor",
      "target":  "processing",
      "timeout": "60s",
      "next":    "checkError"
    },

    /* -------  manejar error  ------- */
    "checkError": {
      "action":   "condition",
      "target":   "errorDialog",
      "operator": "exists",
      "true":     "notifyErr",
      "false":    "handleLayout"
    },
    "notifyErr": {
      "action":   "notify",
      "paramKey": "ErrorMessage",
      "next":     "end"
    },

    /* -------  layout (opcional)  ------- */
    "handleLayout": {
      "action":    "condition",
      "paramKey":  "HasLayout",
      "operator":  "==",
      "value":     true,
      "true":      "chooseLayout",
      "false":     "handleColumns"
    },

    "chooseLayout": {
      "action": "click",
      "target": "chooseLayout.btn",
      "next":   "setLayoutName"
    },
    "setLayoutName": {
      "action":   "set",
      "target":   "chooseLayout.table",
      "paramKey": "LayoutName",
      "next":     "confirmLayout"
    },
    "confirmLayout": {
      "action": "click",
      "target": "chooseLayout.confirm",
      "next":   "handleColumns"
    },

    /* -------  columnas (opcional)  ------- */
    "handleColumns": {
      "action":    "condition",
      "paramKey":  "Columns",
      "operator":  "exists",
      "true":      "changeLayout",
      "false":     "download"
    },
    "changeLayout": {
      "action": "click",
      "target": "changeLayout.btn",
      "next":   "adoptLayout"
    },
    "adoptLayout": {
      "action": "click",
      "target": "changeLayout.adopt",
      "next":   "download"
    },

    /* -------  descargar  ------- */
    "download": {
      "action": "click",
      "target": "saveAs.btn",
      "next":   "end"
    },

    "end": { "action": "exit" }
  }
}